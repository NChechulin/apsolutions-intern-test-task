# Тестовое задание для стажера

- [Тестовое задание для стажера](#тестовое-задание-для-стажера)
  - [Задание](#задание)
    - [Общее описание](#общее-описание)
    - [Структура БД](#структура-бд)
    - [Структура Индекса](#структура-индекса)
    - [Необходимые методы](#необходимые-методы)
    - [Технические требования](#технические-требования)
    - [Программа максимум](#программа-максимум)
  - [Что сделано?](#что-сделано)
  - [О проекте](#о-проекте)
    - [Структура](#структура)
    - [Методы API](#методы-api)
  - [Как запускать?](#как-запускать)

## Задание

### Общее описание

Необходимо написать очень простой поисковик по текстам документов.
Данные хранятся в БД по желанию, поисковый индекс в эластике.
[Тестовые данные](https://api.onedrive.com/v1.0/shares/u!aHR0cHM6Ly8xZHJ2Lm1zL3UvcyFBdldqdXEtLW5zblNrYW8yUzVzMnpUTHpNMHBweHc_ZT1RQnJIMGQ/root/content)

### Структура БД

- `id` - уникальный для каждого документа
- `rubrics` - массив рубрик
- `text` - текст документа
- `created_date` - дата создания документа

### Структура Индекса

- `id` - id из базы
- `text` - текст из структуры БД

### Необходимые методы

- сервис должен принимать на вход произвольный текстовый запрос, искать по тексту документа в индексе и возвращать первые 20 документов со всем полями БД, упорядоченные по дате создания
- удалять документ из БД и индекса по полю  `id`

### Технические требования

- Любой Python фреймворк кроме Django и DRF
- `README` с гайдом по поднятию
- `docs.json` - документация к сервису в формате OpenAPI

### Программа максимум

- функциональные тесты
- сервис работает в Docker
- асинхронные вызовы

## Что сделано?

- [x] БД: SQLite
- Индекс:
    - [ ] Elastic
    - [x] SQLite индекс
- [x] API на Flask со всеми необходимыми методы
- [x] Документация к сервису в формате OpenAPI
- [x] Readme
- [x] Тесты
- [x] Сервис работает в Docker
- [x] Асинхронные вызовы (запросы к БД) 

## О проекте

### Структура

```
.
|-- Dockerfile
|-- README.md
|-- app
|   |-- __init__.py
|   |-- app.py              - "Главный" модуль приложения
|   |-- db.py               - Класс для работы с БД
|   |-- documents.sqlite    - БД, созданная из .csv файда
|   |-- post.py             - Класс для хранения поста - строчки из БД
|   `-- test_api.py         - Тесты
|-- boot.sh                 - Скрипт для запуска сервиса внутри контейнера
|-- docs.json               - Документация в формате OpenAPI
|-- intern_task.py
|-- requirements.txt        - Зависимости
`-- run.sh                  - Скрипт для сборки и запуска контейнера
```

### Методы API

Продублирую документацию к API в читаемом виде:

- `/get_posts`:
    - Тип запроса: GET
    - Параметр: `query` - строка, которую нужно искать
    - Ответ: массив объектов Post:
    ```
    [
        {
            "id": int,
            "text": string,
            "created_date": string,
            "rubrics": [string, string, ...]
        },
        ...
    ]
    ```
- `/delete_record`:
    - Тип запроса: DELETE
    - Параметр: `id` - id поста 
    - Ответ: строка `Success` или строка с ошибкой

## Как запускать?

Для сборки и запуска контейнера нужно запустить bash скрипт: `./run.sh`.
Сервис стартует на порте 5000.
